<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
-->
<htmlform>


    <script type="text/javascript" src="../moduleResources/kenyaemr/scripts/moment.js"></script>
    <script type="text/javascript">

        function onHistoricalStatusDateChange() {

            var today = new Date()//.getTime();        //get current date
            var patientId = <lookup expression="patient.patientId"/>;


            /*this data should not be in Future */
            if (ENC_DATE &gt; today) {
                getField('encounter-date.error').html('Should not be greater than the Current date').show();
            }
            else if(ENC_DATE &lt; bithYear)
            {
                /* Encounter Date should be greater than the Patients's date of Birth    */
                getField('encounter-date.error').html('Should not be less than the date of Birth').show();
            }
            else
            {
                getField('encounter-date.error').hide();
            }

            jq.getJSON('/' + OPENMRS_CONTEXT_PATH + '/kenyaemr/patient/patientUtils/age.action', { patientId: patientId, now: encDate })
                .done(function(data) {
                    onPatientAgeUpdate(data.age);
                });


        }
        $(document).ready(function () {
            $("#date").datepicker({
                changeMonth: false,
                changeYear: true,
                dateFormat: 'dd/mm/yy',
                duration: 'fast',
                stepMonths: 0
            });

            jq("#NonePayingSex").hide();
            jq("#clientphysiaclViolence").hide();
            jq("#historicalPhysicalViolence").hide();
            jq("#sexuaViolence").hide();
            jq("#peer_work_name").hide();
            jq("#year_sarted_sex").hide();
            jq("#yearStartedSexWithMen").hide();

            var male = $('#w11_0');
            var female = $('#w11_1');
            var transgender = $('#w11_2');
            $('input').on('click',function () {
                if (male.is(':checked')) {
                    jq("#year_sarted_sex").hide();
                    jq("#yearStartedSexWithMen").show();
                }
                if (female.is(':checked')) {
                    jq("#yearStartedSexWithMen").hide();
                    jq("#year_sarted_sex").show();
                }
                if(transgender.is(':checked')) {
                    jq("#year_sarted_sex").hide();
                    jq("#yearStartedSexWithMen").hide();
                }
            });


            var sexViolenceckbox = $('#w35_0');
            $('input').on('click',function () {
                if (sexViolenceckbox.is(':checked')) {
                    jq("#sexuaViolence").show();

                } else {
                    jq("#sexuaViolence").hide();
                }
            });

            var physicalViolenceckbox = $('#w39_0');
            $('input').on('click',function () {
                if (physicalViolenceckbox.is(':checked')) {
                    jq("#historicalPhysicalViolence").show();
                } else {
                    jq("#historicalPhysicalViolence").hide();
                }
            });

            var nonepaying_ckbox = $('#w19_0');
            $('input').on('click',function () {
                if (nonepaying_ckbox.is(':checked')) {
                    jq("#NonePayingSex").show();
                } else {
                    jq("#NonePayingSex").hide();
                }
            });

            var clientphysiaclViolence = $('#w47_0');
            $('input').on('click',function () {
                if (clientphysiaclViolence.is(':checked')) {
                    jq("#clientphysiaclViolence").show();
                } else {
                    jq("#clientphysiaclViolence").hide();
                }
            });


            var peer_work_name = $('#w15_0');
            $('input').on('click',function () {
                if (peer_work_name.is(':checked')) {
                    jq("#peer_work_name").show();
                } else {
                    jq("#peer_work_name").hide();
                }
            });


            $('input').on('click',function () {
                var partnerNumber = getField('pNumber.value').val();
                if (partnerNumber !== "") {

                    var phoneNum = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                    if (partnerNumber.match(phoneNum)) {
                        getField('pNumber.error').html('Please enter valid phone number.').hide();
                    } else {
                        getField('pNumber.error').html('Please enter valid phone number.').show();
                        $('#w25').val('');
                        return false;
                    }
                }
            });

            $('input').on('click',function () {

                var mobileNumber = getField('mobile.value').val();
                if (mobileNumber !== "") {

                    var phoneNum = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                    if (mobileNumber.match(phoneNum)) {
                        getField('mobile.error').html('Please enter valid phone number.').hide();
                    } else {
                        getField('mobile.error').html('Please enter valid phone number.').show();
                        $('#w55').val('');
                        return false;
                    }
                }
            });

            $('input').on('click',function () {

                var alternateNumber = getField('alterNumber.value').val();
                if (alternateNumber !== "") {

                    var phoneNum = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                    if (alternateNumber.match(phoneNum)) {
                        getField('alterNumber.error').html('Please enter valid phone number.').hide();
                    } else {
                        getField('alterNumber.error').html('Please enter valid phone number.').show();
                        $('#w57').val('');
                        return false;
                    }
                }
            });

            $('input').on('click',function () {

                var year_startSex_work = getField('startSex.value').val();
                var year_start_having_sex_with_men = getField('sexWithMen.value').val();
                var year_stared_using_drugs = getField('usingDrugs.value').val();

                yearValidation(year_startSex_work, 'startSex')
                yearValidation(year_start_having_sex_with_men,  'sexWithMen')
                yearValidation(year_stared_using_drugs, 'usingDrugs')


            });

            function yearValidation(year, textfield) {


                if (year != 0) {
                    var test=year;
                    if (year.length != 4) {
                        getField(textfield+'.error').html('Please enter valid year.').show();
                        getField(textfield+'.value').val('');
                        return false;
                    }

                    var birthDate= ('(<lookup expression="patient.birthdate"/>)');
                    var bithYear = birthDate.substring(8);
                    if(year &lt; bithYear)
                    {
                        /* Encounter Date should be greater than the Patients's date of Birth    */
                        getField(textfield+'.error').html('Should not be less than the date of Birth').show();
                        getField(textfield+'.value').val('');
                        return false;
                    }
                    else
                    {
                        getField(textfield+'.error').hide();
                    }

                    var current_year = new Date().getFullYear();
                    if ((year > current_year)) {
                        getField(textfield+'.error').html('Year should not be greater than current year.').show();
                        getField(textfield+'.value').val('');
                        return false;
                    }
                    getField(textfield+'.error').html('Please enter valid year.').hide();
                }
            }
        });

        beforeSubmit.push(function() {
            var gender_identity = getField('gender-identity.value').val();

            //var gender_identity_name = jq('.gender_selected input').val();
            var enrolment_area = getField('enrolment_area.value').val();
            var peer_educator = getField('peer-educator.value').val();
            var peer = getField('peer.value').val();
            var regular_sex_partner = getField('regular-sex-partner.value').val();
            var partner_name = getField('pName.value').val();
            var partner_alias = getField('pAlias.value').val();
            var partner_number = getField('pNumber.value').val();
            var contact_regular_sex_partner = getField("contact-regular-sex-partner.value").val();
            var start_sex = getField("startSex.value").val();

            var sex_with_men = getField("sexWithMen.value").val();
            var using_drugs = getField("usingDrugs.value").val();
            var experience_sex_violence = getField("exprienced-sex-violence.value").val();
            var sex_violence_ordeal = getField("sOrdeal.value").val();
            var physical_ordeal = getField("exprienced-physical-violence.value").val();
            var historical_ordeal = getField("hOrdeal.value").val();
            var contatcted_incase_of_appointment = getField("contacted-incase-of-appointment.value").val();
            var clinical_contatcted = getField("cContacted.value").val();
            var experience_phy_violence = getField("exprienced-cphysical-violence.value").val();
            var cordeal = getField("cOrdeal.value").val();

            //Gender validation

            var male = $('#w11_0');
            var female = $('#w11_1');
            var transgender = $('#w11_2');

            if (male.is(':checked') || female.is(':checked') || transgender.is(':checked')) {
                getField('gender-identity.error').html('Please select gender.').hide();
            } else {
                getField('gender-identity.error').html('Please select gender.').show();
                return false;
            }

            // validate enrollment
            if (enrolment_area == "" ) {
                getField('enrolment_area.error').html('Please select enrollment service area.').show();
                return false;
            }else{
                getField('enrolment_area.error').html('Please select enrollment service area.').hide();
            }

            var contacted_by_eductaor = $('#w15_0');
            var notContacted = $('#w15_1');


            if (contacted_by_eductaor.is(':checked') || notContacted.is(':checked')) {
                getField('peer-educator.error').html('Please indicate whether you have been contacted or not').hide();
            } else {
                getField('peer-educator.error').html('Please indicate whether you have been contacted or not').show()
                return false;
            }



            var has_regular_sex_partner = $('#w19_0');
            var doesnot_regular_sex_partner = $('#w19_1');


            if (has_regular_sex_partner.is(':checked') || doesnot_regular_sex_partner.is(':checked')) {
                getField('regular-sex-partner.error').html('Please indicate if you have regular sex partner.').hide();
            } else {
                getField('regular-sex-partner.error').html('Please indicate if you have regular sex partner.').show()
                return false;
            }


            if (partner_number != "") {

                var phoneNum = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                if (partner_number.match(phoneNum)) {
                    getField('pName.error').html('Please enter partner number.').hide();
                } else {
                    getField('pNumber.error').html('Please enter valid phone number.').show();
                    return false;
                }

                //
                // if (start_sex == false) {
                //     getField('Please indicate when you started sex work.error').html('Please indicate when you started sex work.').show();
                //     return false;
                // } else {
                //     getField('Please indicate when you started sex work.error').html('Please indicate when you started sex sex_with_men.').hide();
                // }
            }

        });
    </script>
    <ifMode mode="VIEW" include="true">
        <div>
            <table style="width: 100%">
                <tr>
                    <td align="left">
                        Observation Date:
                    </td>
                    <td>
                        Unique Client Number
                    </td>
                    <td align="right">
                        Gender Identity:
                    </td>
                </tr>
                <tr>
                    <td>
                        16-Jan-2019
                    </td>
                    <td>
                        Test
                    </td>
                    <td align="right">
                        Test
                    </td>
                </tr>
            </table>
        </div>

    </ifMode>

    <div class="ke-form-header">
        <table style="width: 100%">
            <tr>
                <td align="left">Enrolment Date:
                    <encounterDate id="encounter-date" showTime="true"/>
                </td>
                <td align="right">Location:
                    <encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" type="autocomplete"/>
                </td>
            </tr>
        </table>
    </div>

    <div class="ke-form-content">

        <fieldset>

            <table>
                <tr>

                    <td>Unique Client Number</td>
                    <td>
                        <span id="kp-id"><patient id="upn" field="identifier" identifierTypeId="b7bfefd0-239b-11e9-ab14-d663bd873d93" /></span>

                    </td>
                </tr>
                <tr>
                    <td>Gender Identity</td>
                    <td>
                        <obs id="gender-identity" class="gender_selected" conceptId="1533"
                             answerConceptIds="1534,1535"
                             answerLabels="Male,Female" required="true"
                             style="radio" />
                    </td>
                </tr>
                <tr>
                    <td>Enrolment Service Areas</td>
                    <td>
                        <obs id="enrolment_area" conceptId="160540"/>
                    </td>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Client Enrolment Social Status</legend>

            <table>
                <tr>
                    <td>Have you been contacted by a peer educator or an outreach worker for any prevention services?</td>
                    <td>
                        <obs id="peer-educator" conceptId="164983"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr>
                    <table id="peer_work_name" >
                        <td>Peer Educator/Outreach Worker name</td>
                        <td>
                            <obs id="peer" conceptId="1473"/>

                        </td>
                    </table>
                </tr>
                <tr>
                    <td>Do you have a regular(Non-Paying) sexual partner?</td>
                    <td>
                        <obs id="regular-sex-partner" conceptId="165006"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr>
                    <table id="NonePayingSex" >

                        <td>If yes, partners name</td>
                        <td>
                            <obs id="pName" conceptId="161135"/>
                        </td>
                        <td>Alias Name</td>
                        <td>
                            <obs id="pAlias" conceptId="165007"/>
                        </td>
                        <td>Contact Number</td>
                        <td>
                            <obs id="pNumber" conceptId="159635"/>
                        </td>

                    </table>

                </tr>
                <tr>
                    <table>
                        <td>Could we contact your regular sexual partner(s) for prevention services?</td>
                        <td>
                            <obs id="contact-regular-sex-partner" conceptId="165008"
                                 answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                 answerLabels="Yes,No"
                                 style="radio" />
                        </td>
                    </table>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Historical Status</legend>

            <table>
                <tr id="year_sarted_sex">
                    <td>Which year did you start sex work?</td>
                    <td>
                        <obs id="startSex" conceptId="165009"/>
                    </td>
                </tr>
                <tr id="yearStartedSexWithMen">
                    <td>Which year did you start having sex with men?</td>
                    <td>
                        <obs id="sexWithMen" conceptId="165010"/>
                    </td>
                </tr>
                <tr>
                    <td>Which Year Did You Start Using Drugs (Injecting Or Smoking?</td>
                    <td>
                        <obs id="usingDrugs" conceptId="165011"/>

                    </td>
                </tr>
                <tr>
                    <td>
                        Ever experienced sexual violence?</td>
                    <td>
                        <obs id="exprienced-sex-violence" conceptId="123160"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                    <table id="sexuaViolence" >


                        <td>If yes, describe the ordeal</td>
                        <td>
                            <obs id="sOrdeal" conceptId="165012" rows="2" cols="80"/>
                        </td>
                    </table>
                </tr>
                <tr>
                    <td>Ever experienced physical violence?</td>
                    <td>
                        <obs id="exprienced-physical-violence" conceptId="165013"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                    <table id="historicalPhysicalViolence">
                        <td>If yes, describe the ordeal</td>
                        <td>
                            <obs id="hOrdeal" conceptId="165014" rows="2" cols="80" />
                        </td>
                    </table>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Client Support</legend>

            <table>
                <tr>
                    <td>Would you like to be contacted incase you are due for a clinical appointment?</td>
                    <td>
                        <obs id="contacted-incase-of-appointment" conceptId="165015"
                             answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Yes,No"
                             style="radio" />
                    </td>
                </tr>
                <tr>
                    <td>If yes, How would you like to be contacted</td>
                    <td>
                        <obs id="cContacted" conceptId="164966"
                             answerConceptIds="161642,165016,1555,159635"
                             answerLabels="Treatment supporter,Peer educator,Outreach worker,Phone number"/>
                    </td>
                </tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Treatment Buddy Contact Information</legend>

            <table>
                <tr>
                    <td>Treatment support Name</td>
                    <td>
                        <obs id="fname" conceptId="160638"/>
                    </td>
                    <td>Alias Name</td>
                    <td>
                        <obs id="alias" conceptId="165017"/>
                    </td>
                </tr>
                <tr>
                    <td>Mobile Number</td>
                    <td>
                        <obs id="mobile" conceptId="160642"/>
                    </td>
                    <td> Alternative Mobile Number</td>
                    <td>
                        <obs id="alterNumber" conceptId="159635"/>
                    </td>
                </tr>
                <tr>
                    <td>Enrolment Notes</td>
                    <td>
                        <obs id="enNotes" conceptId="161011" rows="2" cols="80"/>
                    </td>
                </tr>
            </table>
        </fieldset>

        <enrollInProgram programId="7447305a-18a7-11e9-ab14-d663bd873d93"/>
    </div>

    <div class="ke-form-footer">
        <submit/>
    </div>

</htmlform>